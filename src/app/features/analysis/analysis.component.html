<!-- Loading Overlay -->
@if (isLoading()) {
  <div class="fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50">
    <div class="text-center">
      <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-sky-500 mx-auto mb-4"></div>
    </div>
  </div>
}

<!-- Main Layout - Only show when not loading -->
@if (!isLoading()) {
  <div class="analysis-layout h-screen-safe flex flex-col bg-white overflow-x-hidden relative">

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 px-4 py-3 flex items-center z-40">
      <p-button
        (onClick)="goBack()"
        icon="pi pi-arrow-left"
        variant="text"
        [rounded]="true"
        class="mr-2"
        ariaLabel="Назад">
      </p-button>
      <h1 class="flex-1 text-center text-lg font-medium text-gray-900 pr-12">
        Финансовый анализ
      </h1>
    </header>

         <!-- Main Content - Scrollable -->
     <main class="flex-1 overflow-y-auto px-5 pt-8 pb-14">

       <!-- Financial Summary Card -->
       <app-financial-summary-card
         [data]="{
           balance: financialData().balance,
           salary: financialData().salary,
           daysUntilSalary: financialData().daysUntilSalary
         }">
       </app-financial-summary-card>

               <!-- Expense Analysis -->
        <app-expense-analysis
          [data]="{
            maritalStatus: financialData().maritalStatus,
            dependentPeople: financialData().dependentPeople,
            expenses: financialData().expenses,
            totalExpenses: financialData().totalExpenses,
            availableForInvestment: financialData().availableForInvestment
          }">
        </app-expense-analysis>

                       <!-- AI Analytics -->
        <app-ai-analytics
          [data]="{
            liquidityStatus: financialData().liquidityStatus || 'good',
            dailyBudget: financialData().dailyBudget,
            availableForInvestment: financialData().availableForInvestment,
            totalExpenses: financialData().totalExpenses
          }">
        </app-ai-analytics>

        <!-- Analysis Tabs Section -->
        <app-analysis-tabs
          [data]="{
            liquidityStatus: financialData().liquidityStatus || 'good',
            dailyBudget: financialData().dailyBudget,
            availableForInvestment: financialData().availableForInvestment,
            totalExpenses: financialData().totalExpenses,
            salary: financialData().salary,
            recommendations: financialData().recommendations,
            expenses: financialData().expenses,
            financialHealthAssessment: financialData().financialHealthAssessment
          }">
        </app-analysis-tabs>
      </main>

      <!-- Bottom Fixed Bar -->
      <div class="ai-assistant-container">
        <div class="flex items-center gap-2">
          <span class="pi pi-sparkles text-orange-500 text-2xl"></span>
          <p class="text-base">
            Как я могу вам помочь?
          </p>
        </div>
        <div class="flex items-center">
          <span class="pi pi-send text-orange-500 text-2xl"></span>
        </div>
      </div>
    </div>
  }
